# 代理修复工具使用说明

## 📋 详细步骤

### 第一步：打开浏览器开发者工具
1. 在 All-Model-Chat 页面上，按键盘上的 **F12** 键
2. 或者右键点击页面，选择"检查"或"检查元素"
3. 开发者工具会在页面底部或右侧打开

### 第二步：找到控制台（Console）
1. 在开发者工具的顶部，找到 **Console** 标签
2. 点击 **Console** 标签切换到控制台界面
3. 您会看到一个可以输入代码的地方（通常有 `>` 符号）

### 第三步：加载修复工具
在控制台中**复制粘贴**以下代码，然后按回车：

```javascript
fetch('./ultimate-proxy-fix.js').then(r=>r.text()).then(eval);
```

**说明**：这行代码会加载修复工具到浏览器中

### 第四步：运行修复
在控制台中**复制粘贴**以下代码，然后按回车：

```javascript
UltimateProxyFix.ultimateFix("AIzaSyCUduSy8NLnF0hKWjgial1Qtm8YQ6-LKr0");
```

**注意**：请将 `AIzaSyCUduSy8NLnF0hKWjgial1Qtm8YQ6-LKr0` 替换为您自己的 API Key

### 第五步：查看结果
运行后，您应该在控制台中看到类似这样的输出：
```
✅ [UltimateProxy] 配置已强制设置
✅ [UltimateProxy] 所有拦截器已激活
✅ [UltimateProxy] 测试成功!
🎉 [UltimateProxy] 终极修复成功!
```

### 第六步：刷新页面测试
1. 按键盘上的 **F5** 键刷新页面
2. 观察是否还出现"User location is not supported"错误
3. 检查模型列表是否正常加载

## 🖼️ 图解说明

### 1. 按 F12 打开开发者工具
```
┌─────────────────────────────────────┐
│  All-Model-Chat 页面                │
│                                     │
│  [按 F12 键]                        │
│                                     │
└─────────────────────────────────────┘
            ↓
┌─────────────────────────────────────┐
│  页面内容                           │
├─────────────────────────────────────┤
│  开发者工具                         │
│  Elements | Console | Network | ... │
│  > _                                │
└─────────────────────────────────────┘
```

### 2. 在 Console 中输入代码
```
Console 标签页：
┌─────────────────────────────────────┐
│ > fetch('./ultimate-proxy-fix.js')  │
│   .then(r=>r.text()).then(eval);    │
│   [按回车执行]                      │
│                                     │
│ > UltimateProxyFix.ultimateFix(     │
│   "您的API-Key");                   │
│   [按回车执行]                      │
└─────────────────────────────────────┘
```

### 问题4：语法错误 "Invalid or unexpected token"
**原因**：代码输入有误
**解决方案**：
1. 确保文件名是 `ultimate-proxy-fix.js`（不是 `ultimate-proxy-fix,js`）
2. 确保箭头函数是 `r=>r.text()`（不是 `r=r.text()`）
3. 确保使用英文引号 `'` 或 `"`

**简化版解决方案**：直接使用以下完整代码（替换为您的API Key）：
```javascript
// 设置代理配置
localStorage.setItem('app-settings', JSON.stringify({
    useCustomApiConfig: true,
    apiProxyUrl: 'https://api-proxy.me/gemini',
    apiKey: 'AIzaSyCUduSy8NLnF0hKWjgial1Qtm8YQ6-LKr0',
    modelId: 'gemini-2.5-flash',
    temperature: 0.7,
    topP: 0.9,
    systemInstruction: '',
    showThoughts: false,
    thinkingBudget: 0,
    language: 'system',
    baseFontSize: 14,
    isStreamingEnabled: true,
    isAutoScrollOnSendEnabled: true,
    isAutoTitleEnabled: true,
    expandCodeBlocksByDefault: false,
    isMermaidRenderingEnabled: true,
    isGraphvizRenderingEnabled: true,
    isAutoSendOnSuggestionClick: true,
    isTranscriptionThinkingEnabled: false,
    transcriptionModelId: 'gemini-2.5-flash',
    ttsVoice: 'Puck',
    themeId: 'system'
}));

// 拦截fetch函数
const originalFetch = window.fetch;
window.fetch = function(input, init = {}) {
    const url = typeof input === 'string' ? input : input.url;
    if (url && url.includes('generativelanguage.googleapis.com')) {
        const proxyUrl = url.replace('https://generativelanguage.googleapis.com/v1beta', 'https://api-proxy.me/gemini/v1beta');
        console.log('🔄 代理请求:', url, '->', proxyUrl);
        const newInput = typeof input === 'string' ? proxyUrl : new Request(proxyUrl, input);
        return originalFetch(newInput, init);
    }
    return originalFetch(input, init);
};

console.log('✅ 代理拦截器已激活，请刷新页面测试');
```

复制上述代码到控制台，按回车执行，然后按F5刷新页面即可。
## 🔧 如果遇到问题

### 问题1：找不到 ultimate-proxy-fix.js 文件
**解决方案**：确保您在 All-Model-Chat 项目的页面上（通常是 http://localhost:5173）

### 问题2：代码执行出错
**解决方案**：
1. 确保完整复制了代码
2. 确保在 Console 标签页中执行
3. 检查是否有拼写错误

### 问题3：修复后仍然有问题
**解决方案**：
1. 完全关闭浏览器，重新打开
2. 清除浏览器缓存
3. 重新运行修复工具

## 📞 需要帮助？

如果您按照以上步骤操作仍然有问题，请：
1. 截图显示您的控制台界面
2. 复制控制台中的错误信息
3. 告诉我具体在哪一步遇到了困难

我会根据您的具体情况提供更详细的帮助！