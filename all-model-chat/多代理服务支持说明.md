# 🌐 多代理服务支持说明

## ✨ 全面支持各种代理服务

代理拦截器现在支持自动识别和适配各种不同的代理服务提供商！

## 🔧 支持的代理服务类型

### 1. API-Proxy.me
```
https://api-proxy.me
https://api-proxy.me/gemini
https://api-proxy.me/gemini/v1beta
```
🔄 **自动处理**：添加 `/gemini/v1beta` 路径

### 2. OpenAI 代理服务
```
https://openai-proxy.example.com
https://ai-proxy.example.com
```
🔄 **自动处理**：添加 `/v1beta` 路径

### 3. Google/Gemini 专用代理
```
https://gemini-proxy.example.com
https://google-proxy.example.com
```
🔄 **自动处理**：添加 `/v1beta` 路径

### 4. Cloudflare Workers
```
https://my-proxy.workers.dev
https://proxy.cloudflare.com
```
🔄 **自动处理**：添加 `/v1beta` 路径

### 5. Vercel 部署
```
https://my-proxy.vercel.app
https://gemini-proxy.vercel.app
```
🔄 **自动处理**：添加 `/v1beta` 路径

### 6. Netlify 部署
```
https://my-proxy.netlify.app
https://gemini-proxy.netlify.app
```
🔄 **自动处理**：添加 `/v1beta` 路径

### 7. 其他云服务
```
https://my-proxy.herokuapp.com    # Heroku
https://my-proxy.railway.app      # Railway
https://my-proxy.render.com       # Render
https://my-proxy.fly.io           # Fly.io
```
🔄 **自动识别**：根据域名特征智能处理

### 8. 本地代理
```
http://localhost:8080
http://127.0.0.1:3000
```
🔄 **自动处理**：添加必要的API路径

### 9. 自定义代理
```
https://my-custom-proxy.com
https://proxy.mydomain.net
```
🔄 **智能处理**：根据URL结构自动适配

## 🧠 智能识别逻辑

### 处理流程

1. **代理类型检测**
   ```javascript
   🔍 检测代理类型: API-Proxy.me
   🔍 检测代理类型: Cloudflare Workers
   🔍 检测代理类型: Custom Proxy
   ```

2. **路径智能处理**
   - 检查是否已包含完整API路径
   - 根据代理类型添加相应路径
   - 确保版本号正确

3. **详细日志输出**
   ```
   ✅ [ProxyInterceptor] 自动启用代理拦截器
   📍 [ProxyInterceptor] 原始URL: https://my-proxy.com
   🎯 [ProxyInterceptor] 处理后URL: https://my-proxy.com/v1beta
   🔧 [ProxyInterceptor] 代理类型: Custom Proxy
   ```

## 📋 使用示例

### 示例1：API-Proxy.me
```javascript
// 用户输入
apiProxyUrl: "https://api-proxy.me"

// 控制台输出
✅ [ProxyInterceptor] 自动启用代理拦截器
📍 [ProxyInterceptor] 原始URL: https://api-proxy.me
🎯 [ProxyInterceptor] 处理后URL: https://api-proxy.me/gemini/v1beta
🔧 [ProxyInterceptor] 代理类型: API-Proxy.me
```

### 示例2：Cloudflare Workers
```javascript
// 用户输入
apiProxyUrl: "https://my-gemini-proxy.workers.dev"

// 控制台输出
✅ [ProxyInterceptor] 自动启用代理拦截器
📍 [ProxyInterceptor] 原始URL: https://my-gemini-proxy.workers.dev
🎯 [ProxyInterceptor] 处理后URL: https://my-gemini-proxy.workers.dev/v1beta
🔧 [ProxyInterceptor] 代理类型: Cloudflare Workers
```

### 示例3：自定义代理
```javascript
// 用户输入
apiProxyUrl: "https://proxy.mydomain.com/api"

// 控制台输出
✅ [ProxyInterceptor] 自动启用代理拦截器
📍 [ProxyInterceptor] 原始URL: https://proxy.mydomain.com/api
🎯 [ProxyInterceptor] 处理后URL: https://proxy.mydomain.com/api/v1beta
🔧 [ProxyInterceptor] 代理类型: Custom Proxy
```

### 示例4：完整API路径
```javascript
// 用户输入
apiProxyUrl: "https://my-proxy.com/v1beta/models"

// 控制台输出
✅ [ProxyInterceptor] 自动启用代理拦截器
📍 [ProxyInterceptor] 原始URL: https://my-proxy.com/v1beta/models
🎯 [ProxyInterceptor] 处理后URL: https://my-proxy.com/v1beta/models
🔧 [ProxyInterceptor] 代理类型: Custom Proxy
🔍 [ProxyInterceptor] 检测到完整API路径，直接使用
```

## 🎯 智能适配规则

### 路径补全规则

1. **已有完整路径**：直接使用，不做修改
2. **基础域名**：根据代理类型添加标准路径
3. **部分路径**：智能补全缺失部分
4. **特殊格式**：根据域名特征进行适配

### 代理类型识别

| 域名特征 | 识别类型 | 处理方式 |
|---------|---------|---------|
| `api-proxy.me` | API-Proxy.me | 添加 `/gemini/v1beta` |
| `workers.dev` | Cloudflare Workers | 添加 `/v1beta` |
| `vercel.app` | Vercel | 添加 `/v1beta` |
| `netlify.app` | Netlify | 添加 `/v1beta` |
| `localhost` | Local Proxy | 添加 `/v1beta` |
| 其他 | Custom Proxy | 智能判断 |

## 💡 最佳实践

### 1. 推荐输入格式
- **完整URL**：`https://your-proxy.com/v1beta`
- **基础域名**：`https://your-proxy.com`（系统自动处理）

### 2. 验证方法
1. 查看控制台日志确认代理类型识别
2. 检查处理后的URL是否正确
3. 发送测试消息验证代理工作

### 3. 故障排除
- 如果代理不工作，检查控制台日志
- 确认代理服务器支持Gemini API格式
- 验证API Key是否有效

## 🔄 动态适配

系统会根据您输入的代理地址自动：

- ✅ **识别代理类型**：显示具体的代理服务商
- ✅ **智能路径处理**：添加必要的API路径
- ✅ **格式标准化**：确保符合Gemini API规范
- ✅ **详细日志**：提供完整的处理过程信息

现在您可以使用任何代理服务，系统会自动适配！🚀